# 测试左移&右移
常规流程: `需求 - 开发 - 测试 - 上线`. 从这个流程可以看出测试这个角色才参与流程是靠后的,因为依赖于开发交付的成果.

但是这种模式会存在一些问题, 
1. 工作量不均衡, 测试在开发编码阶段工作量较轻, 到测试这个阶段又过重, 开发则反之
2. 测试介入靠后, 开发成果存在缺陷, 越后期修复成本越高. 测试人员精力疲于修复简单的缺陷,而不能专注于深层次测试中且有较大可能性导致上线延期

## 破局
通过测试左移右移, 让测试有更多的主动权

### 测试左移
本质: 越早发现不合理的地方, 出问题的概率越低

目的: 
1. 提高质量上线: 通过一系列措施, 使问题在起步阶段就得到解决
2. 提高质量下限: 通过一系列措施, 使开发交付的成果底线得到了保障
3. 缩小测试周期: 交付的成果质量高, 那么测试环节的时间也会相应的降低

核心:
全员质量服务意识, 都为产品质量服务. 测试团队是有限的, 质量的参与人员不仅仅局限于测试人员, 只有通过赋能质量意识, 使团队成员都具备质量意识, 才能有效提高质量

措施:
- 有哪些活动可以提高质量上限（举例）？

1. 健康的项目流程（合理并且严格遵守的项目流程）
2. 合理的需求分析（评估需求的质量，分析需求的合理性以及完整性）
3. 出色的系统架构
4. 完整的系统设计（评估设计的质量，分析需求的合理性以及完整性）
5. 进行研发标准的定义
6. 更早的测试分析（先于开发完成需求的分析，做好各种评审的准备）
7. 尽早的测试执行（提早参与测试执行，在集成前就发现一些问题）

- 有哪些活动可以提高质量下限（举例）？

1. 健康的测试流程
2. 优秀的测试用例
3. 合理的测试计划
4. 合适的自动化
5. 适当的探索式测试
6. 充分利用静态代码扫描
7. 开发自测（TDD、BDD，测试提供更好的用例、技术支持）
8. 团队质量意识的培养

落地措施:
1. 质量文化的赋能
2. 质量规范梳理
3. 项目进度(里程碑, 项目周期)
4. 环节交付输出 (需求理解,单元测试, 上线时间, 线上问题)


### 测试右移
目的: 及时发现,及时反馈

核心: 围绕问题反馈、发现、定位、监控展开，参与人员则不仅仅局限于运维人员

措施: 
1. 通过接入`prometheus` + `granfana` 实现数据监控
    1. 服务器性能(cpu, 内存, i/o, 网络)
    2. 业务指标(注册量, 进件量, 通过量, 拒绝量, 放款量, 还款量, 短信发送量, 三方验证量)
    3. 风控指标
2. 接入阿里云日志告警(邮件, 短信)

# 测试理论
## 测试计划
1. 测试范围
2. 测试策略
    1. 明确”产品目标“
    2. 进行”风险分析“
    3. 适配”产品研发流程“
3. 测试资源
    1. 人力资源
    2. 环境资源
    3. 设备资源

# 工作流:
1. 测试导图前置: 填充细节 梳理优化逻辑
2. 测试导图跟产品简单过一下,双方确认无误
3. 需求评审 - 导图评审: 辅助开发对需求理解
4. 需求分解 - 工作量预估: 精细化管理
5. 开发概要设计: 参与设计 关注有没有漏
6. 模块提测: 模块冒烟及功能测试
7. 集成测试: 集成间测试, 重点关注新模块
8. 第二轮测试: 探索性 深度 缺陷处理
9. 预生产上线: 模拟生产上线
10. 预生产测试: 确认测试 确保上线未导致功能故障
11. 生产上线
12. 生产监控: 生产数据监控

# DevOps&CICD
- 采用 jenkinsfile + share library + scm 进行版本管理
- 容器化集群(k8s) 通过在k8s部署slave, 方便水平扩容 弹性伸缩

1. 合并到test环境, 触发单元测试和静态检查, 成功合并失败拒绝
2. 构建镜像 push仓库
3. 部署环境, pull仓库
4. 并发执行测试(接口 ui)
5. 人工验收通知(robot)

DevOps是一种思想、一组最佳实践、以及一种文化。DevOps是CICD思想的延伸，CICD是DevOps的基础核心，如果没有CICD自动化的工具和流程，DevOps是没有意义的。
- 困境:
    1. 涉及部门多
    2. 流程复杂
    3. 边界重新划分
    4. 自动化工具链是核心问题
- CI: 持续集成, 快速发现错误
- CD: 持续交付 持续部署

实践:
1. 通用工具链(jenkins,confluence,k8s,jira等)由运维推动
2. 专业工具链(例如:静态扫描,Sonar,自动化测试等)由相关职能部门推动
3. 全员灌输devops理念,每个职能推出KOL,对实践进行推动和优化
4. 依托自动化工具把开发、测试、发布、部署的过程整合，实现高度自动化与高效交付
5. 采用敏捷开发流程
    1. 采用看板方法:
        - 早上每天站会,沟通情况(任务状态，计划，以及障碍)
        - 每个月开回顾会,反思以及制定接下来的行动计划
        - 发布计划会(上线前最后的确认)
        - 小项目组,快迭代的模式
        - 小颗粒度划分任务
6. 相关职能部门推动自己的流程优化
    1. 开发:
        - 采用TDD开发模式
        - 制定代码合并标准
    2. 测试:
        - 推动自动化测试
        - 推动测试左右移
            - 左移(测试提前介入或赋能介入):
                1. 质量文化推广
                2. 质量体系建设
                3. 赋能开发自测
            - 右移(部署运营阶段的持续监控):
                1. 服务监控
                2. 业务监控

# 工程效能
1. 持续发布能力，它包括发布频率和发布前置时间，也就是从代码提交到功能上线花费的时间。
2. 需求响应周期，它包括交付周期时间和开发周期时间，交付周期时间指的是从确认用户提出的需求开始，到需求上线所经历的平均时长。开发周期时间指的是从开发团队理解需求开始，到需求可以上线所经历的平均时长。
3. 交付吞吐率，指的是单位时间内交付需求的数量；实际研发中，可以给出标准化的story/task定义，保证每个项目组的考核通用性。
4. 交付过程质量，它包含两个细分的指标，分别是开发过程中bug的创建和修复时间分布，以及bug库存; 当然, 也可以加一些譬如reopen率这样的指标。
5. 对外交付质量，它包含两个细分的指标，分别是单位时间的线上故障数，以及故障平均解决时长。

# 管理
- OKR: O 目标 KR 关键点
- action
1. 跟团队探讨质量的可能性
2. 分析并推动更优的质量管控措施
3. 质量体系规划和建设工作
4. 问题挖掘能力
# 大厂前沿
AI测试
1. 手淘AIOps实战-消息全链路异常检测
2. 从0到1，机器学习产品的精益质量

# jira
流程: 开始, 待确认, 修复中, stash, 重新打开, 待验证, 测试环境修复, 关闭, 完成

模块: 项目, 问题类型, 优先级, 概要, 经办人, 版本, 模块, 环境, 附件, 详情, 报告人

# 流程
- 瀑布式: 是一种线形的、顺序的软件开发模型
1. 特点: 顺序性, 依赖性, 具备里程碑特征, 基于文档驱动, 严格的阶段评审
2. 优点: 有利于大型软件开发过程人员的组织和管理
3. 缺点: 不够灵活, 周期长

# 用例设计
1. 等价类: 标准, 有效等价类, 无效等价类
2. 边界值: 针对条件限制的边缘进行测试
3. 错误推测法: 基于经验和直觉推测程序中所有可能存在的各种错误,从而有针对性的设计测试用例的方法
4. 因果图: 对输入条件的组合情况、输入条件之间的相互制约关系进行分析
5. 场景设计法: 通过事件流的形式测试集成状态

# 质量模型:
1. 功能性: 适合性, 准确性, 安全性
2. 可靠性: 成熟性, 容错性, 易恢复性
3. 易用性: 易理解性, 易学性, 易操作性
4. 效率: 时间, 资源
5. 维护性: 易分析性, 稳定性, 易测试性
6. 可移植性: 易安装, 易替换

# 质量影响要素
技术, 流程, 阻止

# 测试用例
用例编号

用例标题

功能模块名称

前置条件

输入数据

操作步骤

预期结果

优先级

执行结果

编写人

执行人

# django
## 请求流程
`get_wsgi_application() --> WSGIHandler() --> self.load_middleware() --> __call__() --> self.get_response() --> confurl.dispatch --> view --> Reponse`

# 算法
1. 父子数组, 合并去重
`reduce(lambda x,y: set(x) | set(y), array)`

# 自定义nodeid
参数:
1. rename: 判断插件是否开启
2. skip: 指定需要skip的nodeid
3. skip-json: 指定需要skip的json文件

工作流:
1. `pytest_collection_modifyitems`
- 判断是否开启使用
- 提取正则结果
- 修改nodeid name

2. pytest_configure
- 判断是否开启skip和skip-json
- 将skip和skip-json合并

3. pytest_report_teststatus
- 判断是否为call阶段
- 判断状态是否为失败
- 将nodeid头部存储

4. pytest_runtest_setup
- 判断当前用例是否需要skip
- 执行skip

# 失败截图
参数:
1. screenshot: 开关
2. screenshot_path: 截图地址

1. pytest_configure
- 如果两个参数都为on, 则归档历史截图

2. pytest_runtest_makereport
- 查找driver实例
- 根据模式 执行截图
    1. 保存到指定地址
    2. 保存到`项目/screenshot`
    3. 无保存,仅附加到


# api框架
参数:
- -E: 环境
- -P: 项目
- -S: sheet
- --mark: sheet文件


1. pytest_configure
- 初始化配置, 将配置文件加载到上下文中

2. pytest_xdist_auto_num_workers
- 将并发数量调整为sheet数

3. pytest_generate_tests
- 读取excel
- 用例参数化

事件
1. 强制等待
2. 前置sql
3. 动态请求
4. 响应断言
5. 提取数据
6. 数据库断言
7. 后置sql
8. 归档

# ui框架
参数
- -P: 项目
- -E: 环境
- -S: 服务器
- -M: 模式
- -A: app包位置
- --device: 指定设备

1. pytest_configure
- 加载配置

2. pytest_collection_modifyitems
- 根据模式选择运行用例
- 将未选中用例添加到pytest_deselected中

3. pytest_runtest_makereport
- 在web模式下,发送cookie,用于在zalenium中声明运行结果

4. pytest_runtest_call
- 在web模式下,发送cookie,用于在zalenium中做注释

api用例: 500  sheet: 40+
平台用例: 700 场景100+
ui用例: 100 

# http
三次握手 四次挥手 CA证书 https交换流程 
http1.1
长连接
缓存处理
2.0
服务推送
多路复用

# nginx
优势:
- 响应快
- 高并发5w
- 低内存
- 高可靠
- 热部署

工作过程:
1. master建立监听套接字
2. master fork worker进程
3. master发送相关信号给worker
4. 所有worker的监听套接字在有新连接时都会变成可读
5. worker在读取前需要抢互斥锁
6. 抢到的worker开始处理事物, 完成后断开连接

架构:
1. master: 管理worker
2. worker: 处理网络事件

最大连接数:
1. 静态最大连接数: 连接数 * 进程 / 2
2. 反向代理最大连接数: 连接数 * 进程 / 4

命令行:
1. nginx -s reload 重启
2. nginx -s stop 快速关闭
3. nginx -s quit 优雅关闭
4. nginx restart 重启
5. nginx -v 查看版本
6. nginx 启动
7. nginx -t 检查配置

# shell
- 组:
    - groupadd 组名
    - groupdel 组名
- 用户:
    - useradd 用户名
    - userdel -r 用户名
    - passwd 用户名
    - usermod -g 组 用户名
- 属主
    - chown user file
    - chown -R user file
- 属组
    - chgrp group file
    - chgrp -R group file
- 权限
    - chmod a=rwx file
    - chmod 741 file
    - chmod u+w,g+r,o+x file
    - chmod u=wrx,g=rx,o=x file
- 其他:
    - 文件大小: `du -ah`
    - 磁盘: `df -h`
    - 内存: `free -m`
    - 关机: `init0 halt`
    - 重启: `init6 reboot`

- head: 默认前10条
- tail: 默认后10条
- cut: -d 分隔符 -f 作用域
- uniq: -c 数量 -d 仅显示重复的
- sort: -n 数字 -r 倒序 -k 作用域
- wc: 行数 单词数 字节数
- find: -name 查找文件
- grep: -i 区分大小写 -c 匹配总量 -l 文件名 -r 递归 -n 行号 -w 单词
- sed: -i 真实 -n 仅显示 -f 文件
    - a后 i前 r写入 w输出 p显示 s/old/new/ig替换 删除d
    - `/^start/,/^end/`
- awk
    - 格式: `awk 'BEGIN{}PATTERN{COMMAND}END{}' file`
    - `printf %20s%20s, $1, $2` %s %d %f
    - $0 $1 $2 $NF $NR
    - FS RS
- 表达式
    - -eq -lt -ne -gt
    - && ||
    - [ 2 == 2 ]
- 函数
    - `func(){}`
    - $0 $1 $2 $# $* $@ $?
- if
```shell
if [ ${2} -eq ${3} ]
then
    echo "1"
elif [ ${2} -gt ${3} ]
then
    echo "2"
else
    echo "3"
if
```
- for
```shell
for x in $(ls)
do
    echo ${x}
done
```
- while
```shell
while [ ${2} -lt 3 ]
do
    echo "suceess"
done
```
- until
```shell
until [ ${3} -gt 5 ]
do
    echo "until"
done
```
- case
```shell
case ${2} in
    1)
        echo "1"
        ;;
    *)
        echo "2"
esac
```

# docker
- systemctl daemon-reload
- systemctl restart docker
- systemctl start docker
- 健康检查
    - cmd interval retries timeout start-period
- dockerfile
    - FROM ENTRYPOINT LABEL RUN CMD ENV ARG COPY ADD WORKDIR USER VOLUME EXPOSE HEALTHCHECK
- docker compose
    - 命令: up down scale web=3 
        - -d守护 -f文件 -p项目
    - docker-compose.yml
        - version serivces build restart depends_on healthcheck command labels
```yaml
version: "3"

services:
  sonarqube:
    image: sonarqube:latest
    ports:
      - "9000:9000"
    networks:
      - sonarnet
    environment:
      TZ: Asia/Shanghai
      SONARQUBE_JDBC_USERNAME: sonar
      SONARQUBE_JDBC_PASSWORD: sonar
      SONARQUBE_JDBC_URL: jdbc:postgresql://db:5432/sonar
    depends_on:
      - db
      
    volumes:
      - sonarqube_conf:/opt/sonarqube/conf
      - sonarqube_data:/opt/sonarqube/data
      - sonarqube_extensions:/opt/sonarqube/extensions
      - sonarqube_bundled-plugins:/opt/sonarqube/lib/bundled-plugins
      - sonarqube_log:/opt/sonarqube/log

  db:
    image: postgres:11.1
    networks:
      - sonarnet
    environment:
      POSTGRES_USER: sonar
      POSTGRES_PASSWORD: sonar
      TZ: Asia/Shanghai
      POSTGRES_DB: sonar
    volumes:
      - postgresql_data:/var/lib/postgresql/data

networks:
  sonarnet:
    driver: bridge

volumes:
  sonarqube_conf:
  sonarqube_data:
  sonarqube_extensions:
  sonarqube_bundled-plugins:
  postgresql_data:
  sonarqube_log:
```
# jenkins
- jenkinshome: /var/jenkins_home
- pipeline: 运行于Jenkins上的工作流框架，将原本独立运行于单个或者多个节点的任务连接起来，实现单个任务难以完成的复杂流程编排与可视化，帮助Jenkins实现从CI到CD与DevOps的转变
    - 代码（Code）: Pipeline以代码的形式实现，通常被检入源代码控制，是团队能够编辑，审查 和迭代其CD流程。
    - 可持续性（Durable）:Jenkins重启或者中断后都不会影响Pipeline Job。
    - 可停顿（Pausable）:Pipeline可以选择停止并等待人工输入或者批准，然后再继续Pipeline运行。
    - 多功能（Versatile）:Pipeline支持实现现实世界的复杂CD要求，包括fork/join子进程，循环和并行执行工作的能力。
    - 可拓展（Extensible）:Pipeline插件支持其DSL的自定义扩展及与其他插件集成的多个选项。
- 声明式 脚本式(groovy)
- pipeline agent stages stage step
- post: always success failure unstable changed
- environment input checkout parameters(调用: params.Greeting) stash存放 unstash取出 choice retry timeout超时 triggers tools when(expression not allOf anyOf) script parallel build sleep options label
- 全局变量: 
    - `env.BUILD_ID`: 当前版本ID
    - `env.JOB_NAME`: 构建项目的名称
    - `env.JENKINS_URL`: 完整的Jenkins网址(需要在系统配置)
- Jenkinsfile
- jira to wechat
    - `Generic Webhook Trigger`: 通用可配置webhook(可解析)
    - `HTTP Request Plugin`: http请求
    - 实现:
        - 在jira中设置webhook
# celery
- 架构: master broker worker 结果存储
- 命令行:
    - celery multi start w1 -A demo -l info --pidfile=./celery/%n.pid --logfile=./celery/%n%I.log
        - kill stopwait stop restart start
    - celery -A demo beat -l info --detach --logfile=./celery/%n.log
    - celery -A 工程 events
- 配置:
    - 地址 时区 过期时间 超时 并发量 限流
- shared_task
    - delay(键值对形式)
    - apply_async(args kwargs)
    - ready 状态
    - result 结果
- django_celery_beat
    - 四种定时模式: 经纬 时间 间隔 cron
    - cron五种模式: 分钟 小时 周天 月天 年月
    - name task 定时模式 参数 过期时间 开始时间 优先级 开关 运行次数 详情
    - 更新 update_changed
    - 信号: 接受close_old_connections, 运行结束, 失败, 终止
# gunicorn
- Gunicorn是一个WSGI HTTP服务器,使用了pre-fork + master-worker模式,gunicorn在启动时,会在主进程中预先fork出指定数量的worker进程来处理请求,推荐的worker数量是(2*$num_cores)+1
1. master建立监听套接字
2. master fork worker进程
3. master发送相关信号给worker
4. 所有worker的监听套接字在有新连接时都会变成可读
5. worker在读取前需要抢互斥锁
6. 抢到的worker开始处理事物, 完成后断开连接
- 命令
    - gunicorn -w 4 -b 0.0.0.0:8000 demo:app
    - -w 工人数 -b socket -D daemon运行 --worker-connections：worker最大连接数
    - reload 
    - gunicorn project_name.asgi:application -w 4 -k uvicorn.workers.UvicornWorker

# CSS
- color font-size text-align  padding margin
    - position: relative相对定位 fixed 固定定位
    - float: 浮动
    - Flex Box: 弹性盒子: display:flex flex-direction row row-reverse column column-reverse
- 选择器
    - .class  
    - #ID  
    - .class vars    
    - a[name]
- 伪类
    - :active激活 :focus焦点 :hover悬浮 :visited已访问
- 伪元素
    - :before :after :not
- 权重: !important > 行内样式 > id选择器 > 类 属性 伪类 > 标签 伪元素 > 通配符
# html
三种标签: 块元素div p 内联元素a span 内联块元素input img
# db
- offset distinct 
- 括号 > and > or
- %通配 _占位
- RTRIM LTRIM TRIM
- 时间: CURDATE() NOW() CURTIME() DATE() DATE_ADD(DATE, INTERVAL ? DATE) DATE_SUB
- 文本处理: LEN() LOWER UPPER()
- 聚合函数: AVG COUNT MAX MIN SUM ROUND
- group
    1. 在group by中使用的字段才可以在select中使用
    2. where不能用聚合函数 having可以且必须出现在select中
- 联结: inner join  left join  right join union  union all
- 插入: insert info 表名 values 更新: update 表名 set where 删除 delete from 表名 where
- 建表: CREATE TABLE 表名(字段名 类型 约束 参数)
- 加字段: ALTER TABLE 表名 ADD 名 类型 约束 参数;
- 加约束: ALTER TABLE 表名 ADD CONSTRAINT 约束 (字段);
- 删除字段: ALTER TABLE 表名 DROP COLUMN 字段;
- 删表: DROP TABLE 名;
- 重命名: RENAME TABLE OLD TO NEW
- 约束: PRIMARY KEY  REFERENCES 表(字段)  UNIQUE
- 类型: INTEGER DATETIME CHAR(10)
- 索引: CREATE INDEX 名 ON 表(字段);
- 创建用户: create user '用户名'@'host' identified by '密码';
- 修改密码:
    - SET PASSWORD FOR 'username'@'host' = PASSWORD('newpassword');
    - set password=password("123");
- 删除用户: drop user '用户名'@'host';
- 权限: grant all on 数据库名.表名 to '用户名'@'地址';
- MYSQL_ROOT_PASSWORD=123456 root用户密码
- MYSQL_DATABASE=myproject 数据库名
- MYSQL_USER=dbuser 普通用户名
- MYSQL_PASSWORD=password  普通用户密码

# jira
问题类型 工作流 界面 字段 优先级 状态
- 状态: 转换 状态 (触发器 条件(限制操作人) 验证器 后处理功能(钩子))
- 问题类型: 功能错误 ui问题 功能确实 体验问题 系统配置 需求逻辑
- 字段: 项目 问题类型 优先级 概要 经办人 影响版本 模块 环境 描述 报告人
# JS
